<!DOCTYPE html>
<meta charset="utf-8">
<style>
/*
	.bar {
		fill: steelblue;
	}*/
	.bar:hover {
		fill:orange;
	}

	.axis {
		font: 10px sans-serif;
	}

	.axis path,
	.axis line {
		fill: none;
		stroke: #000;
		shape-rendering: crispEdges;
	}

	.x.axis path {
		display: none;
	}

	svg {
		width: 100%;
	}
</style>
<script src="//d3js.org/d3.v3.min.js"></script>
<body style='margin:0;padding:0;'>
<script>
	var margin = {top: 20, right: 20, bottom: 230, left:40},
			inputbutton = 50,
			width = window.innerWidth - margin.left - margin.right,
			height = 700 - margin.top - margin.bottom - inputbutton;

	var vername = "議会費";
	var x = d3.scale.ordinal()
						.rangeRoundBands([0, width], .1);
	var y = d3.scale.linear()
						.range([height, 0]);

	var bx = d3.scale.ordinal()
		.rangeRoundBands([0, width], .1);
	
	var xAxis = d3.svg.axis()
								.scale(x)
								.orient("bottom");

	var yAxis = d3.svg.axis()
								.scale(y)
								.orient("left")
								.ticks(10);

	var svg = d3.select("body").append("svg")
							.attr("width", width + margin.left + margin.right)
							.attr("height", height + margin.top + margin.bottom)
						.append("g")
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	d3.csv("data.csv", type, function(error, data){
		if (error) throw error;

		var colname = d3.map(data[0]).keys();
		colname.shift();
		
		x.domain(data.map(function(d) {return d.tag}));
		y.domain([0, d3.max(data, function(d) {return d["議会費"];})]);

		var maxv = d3.max(data, function(d) {return d[vername];});
		var minv = d3.min(data, function(d) {return d[vername];});

		svg.append("g")
			 .attr("class", "x axis")
			 .attr("transform", "translate(0," + height + ")")
			 .call(xAxis);

		svg.append("g")
			 	.attr("class", "y axis")
				.attr("transform", "translate(" + margin + "," + margin + ")")
			 	.call(yAxis)
			.append("text")
				.attr("class", "vername")
			 	.attr("y", 6)
				.attr("x", 10)
			 	.attr("dy", ".71em")
				.attr("dx", -10)
				.attr("transform", "rotate(-90)")
			 	.style("text-anchor", "end")
			 	.text(vername+"/人");

		svg.selectAll(".bar")
			 	.data(data)
			.enter().append("rect")
			 	.attr("class", "bar")
			 	.attr("x", function(d) { return x(d.tag);})
			 	.attr("width", x.rangeBand())
			 	.attr("y", function(d) { return y(d[vername]);})
			 	.attr("height", function(d) {return height - y(d[vername]);})
				.attr("fill", function(d) {
						console.log(minv);
						var colval = Math.ceil(d[vername]*255/maxv);
						colval =  350 - colval;
						return "rgb(0,0," + colval + ")";
				});
/*
		svg.selectAll("input")
				.data(colname)
				.enter().append("input")
				.attr("type", "button")
				.attr("value", function(d) {return d;})
				.attr("transform", "translate(0," + (height+20) + ")")
				.attr("x", function(d, i) {
						return i * width/colname.length;
					})
				.attr("width", 60)
				.attr("height", 20)
*/
		svg.selectAll(".text")
			 .data(colname)
			 .enter().append("text")
			 .attr("class", "text")
			 .attr("transform", "translate(10," + (height+35) + ")")
			 .attr("x", function(d, i) {
				 	return i*width/colname.length;
				 })
			 .attr("font-size", "12px")
			 .text(function(d){ return d;})
			 .on("click", function(d){
				 vername = d;
				 maxvalue = d3.max(data, function(d) {typead(d, vername); return d[vername];});
				 y.domain([0, maxvalue]);
				 yAxis.scale(y);
				 svg.select(".y.axis")
				 	.transition()
					.duration(1000)
					.attr("transform", "translate(0," + margin + margin + ")")
					.call(yAxis)

				svg.select(".vername")
					.transition()
					.text(vername+"/人")
				 svg.selectAll("rect")
				 	.data(data)
					.transition()
					.attr("y", function(d) { return y(d[vername]); })
					.attr("height", function(d) { return height-y(d[vername]); })
				});
	});

	function type(d, i) {
		d["議会費"] = +d["議会費"];
		return d;
	}

	function typead(d, name){
		d[name] = +d[name];
		return d;
	}
	

	function inputdata(d, i){
		console.log(i);
		vername = d;
		console.log(col);
		y.domain([0, d3.max(data, function(d) {return d[vername]})]);
	d3.csv("data.csv" , function(err, data){
		if(err) {console.log(err);}
		svg = d3.selectAll("rect")
		.data(data)
		.transition()
		.attr("y", function(d) {
			return y(d[vername]);
		})
		.attr("height", function(d){
			return height - y(d[col]);
		});
	});
}

</script>
